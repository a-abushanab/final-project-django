{% extends 'base.html' %}
{% block title %}All Borrowings — E-Library{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h3 class="fw-bold"><i class="bi bi-list-check me-2 text-primary"></i>All Borrowings</h3>
  <div>
    <a href="?status=" class="btn btn-sm {% if not status_filter %}btn-primary{% else %}btn-outline-primary{% endif %}">All</a>
    <a href="?status=borrowed" class="btn btn-sm {% if status_filter == 'borrowed' %}btn-warning{% else %}btn-outline-warning{% endif %} ms-1">Active</a>
    <a href="?status=returned" class="btn btn-sm {% if status_filter == 'returned' %}btn-success{% else %}btn-outline-success{% endif %} ms-1">Returned</a>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-hover shadow-sm">
    <thead class="table-primary">
      <tr>
        <th>Student</th>
        <th>Book</th>
        <th>Borrowed</th>
        <th>Due Date</th>
        <th>Returned</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for record in records %}
      <tr {% if record.is_overdue %}class="table-danger"{% endif %}>
        <td>
          <strong>{{ record.student.get_full_name|default:record.student.username }}</strong>
          <br><small class="text-muted">{{ record.student.email }}</small>
        </td>
        <td>
          <a href="{% url 'book_detail' record.book.pk %}" class="text-decoration-none">{{ record.book.title }}</a>
        </td>
        <td>{{ record.borrow_date }}</td>
        <td>
          {{ record.due_date }}
          {% if record.is_overdue %}
          <span class="badge bg-danger ms-1">Overdue!</span>
          {% endif %}
        </td>
        <td>{{ record.return_date|default:"—" }}</td>
        <td>
          {% if record.status == 'borrowed' %}
          <span class="badge bg-warning text-dark">Borrowed</span>
          {% else %}
          <span class="badge bg-success">Returned</span>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="6" class="text-center text-muted py-4">No records found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
