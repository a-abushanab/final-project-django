{% extends 'base.html' %}
{% block title %}Admin Dashboard â€” E-Library{% endblock %}

{% block content %}
<h3 class="fw-bold mb-4"><i class="bi bi-speedometer2 me-2 text-primary"></i>Admin Dashboard</h3>

<!-- Stats cards -->
<div class="row g-4 mb-4">
  <div class="col-6 col-md-3">
    <div class="card border-0 shadow-sm text-center p-3 bg-primary text-white">
      <i class="bi bi-journals display-5"></i>
      <h2 class="fw-bold mt-2">{{ total_books }}</h2>
      <p class="mb-0">Total Books</p>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="card border-0 shadow-sm text-center p-3 bg-success text-white">
      <i class="bi bi-people display-5"></i>
      <h2 class="fw-bold mt-2">{{ total_students }}</h2>
      <p class="mb-0">Students</p>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="card border-0 shadow-sm text-center p-3 bg-warning text-dark">
      <i class="bi bi-book display-5"></i>
      <h2 class="fw-bold mt-2">{{ active_borrowings }}</h2>
      <p class="mb-0">Active Borrowings</p>
    </div>
  </div>
  <div class="col-6 col-md-3">
    <div class="card border-0 shadow-sm text-center p-3 bg-danger text-white">
      <i class="bi bi-exclamation-triangle display-5"></i>
      <h2 class="fw-bold mt-2">{{ overdue_borrowings }}</h2>
      <p class="mb-0">Overdue</p>
    </div>
  </div>
</div>

<div class="row g-4 mb-4">
  <div class="col-md-2">
    <div class="card border-0 shadow-sm text-center p-3">
      <i class="bi bi-person-lines-fill display-5 text-secondary"></i>
      <h3 class="fw-bold mt-2">{{ total_authors }}</h3>
      <p class="mb-0 text-muted">Authors</p>
    </div>
  </div>
  <div class="col-md-2">
    <div class="card border-0 shadow-sm text-center p-3">
      <i class="bi bi-tags display-5 text-secondary"></i>
      <h3 class="fw-bold mt-2">{{ total_categories }}</h3>
      <p class="mb-0 text-muted">Categories</p>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- Top borrowed books -->
  <div class="col-md-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white fw-bold py-3">
        <i class="bi bi-trophy me-2 text-warning"></i>Top Borrowed Books
      </div>
      <ul class="list-group list-group-flush">
        {% for book in top_books %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <a href="{% url 'book_detail' book.pk %}" class="text-decoration-none fw-semibold">{{ book.title }}</a>
          <span class="badge bg-primary rounded-pill">{{ book.borrow_count }}</span>
        </li>
        {% empty %}
        <li class="list-group-item text-muted text-center">No borrowing data yet.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Top students -->
  <div class="col-md-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white fw-bold py-3">
        <i class="bi bi-person-badge me-2 text-success"></i>Most Active Students
      </div>
      <ul class="list-group list-group-flush">
        {% for student in top_students %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span>{{ student.get_full_name|default:student.username }}</span>
          <span class="badge bg-success rounded-pill">{{ student.borrow_count }}</span>
        </li>
        {% empty %}
        <li class="list-group-item text-muted text-center">No student data yet.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Recent borrowings -->
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white fw-bold py-3">
        <i class="bi bi-clock-history me-2 text-primary"></i>Recent Borrowings
      </div>
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Student</th>
              <th>Book</th>
              <th>Date</th>
              <th>Due</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for record in recent_borrowings %}
            <tr {% if record.is_overdue %}class="table-danger"{% endif %}>
              <td>{{ record.student.get_full_name|default:record.student.username }}</td>
              <td><a href="{% url 'book_detail' record.book.pk %}" class="text-decoration-none">{{ record.book.title }}</a></td>
              <td>{{ record.borrow_date }}</td>
              <td>{{ record.due_date }}</td>
              <td>
                {% if record.status == 'borrowed' %}
                <span class="badge bg-warning text-dark">Borrowed</span>
                {% else %}
                <span class="badge bg-success">Returned</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="5" class="text-center text-muted py-3">No borrowings yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
