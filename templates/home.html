{% extends 'base.html' %}
{% block title %}Home — E-Library{% endblock %}

{% block extra_css %}
<style>
  /* HERO */
  .hero-section {
    background: linear-gradient(135deg, #0d47a1 0%, #1565c0 45%, #283593 100%);
    color: #fff;
    padding: 80px 0 60px;
    position: relative;
    overflow: hidden;
  }
  .hero-section::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      radial-gradient(circle at 15% 60%, rgba(255,255,255,.07) 0%, transparent 45%),
      radial-gradient(circle at 85% 15%, rgba(255,255,255,.09) 0%, transparent 40%);
    pointer-events: none;
  }
  .hero-logo-box {
    background: rgba(255,255,255,.15);
    border: 1px solid rgba(255,255,255,.25);
    border-radius: 18px;
    padding: 16px 20px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .hero-cta-primary {
    background: #fff;
    color: #0d47a1;
    font-weight: 700;
    border: none;
    padding: .75rem 2rem;
    border-radius: 8px;
    transition: transform .15s, box-shadow .15s;
  }
  .hero-cta-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0,0,0,.2);
    color: #0d47a1;
  }
  .hero-cta-secondary {
    border: 2px solid rgba(255,255,255,.6);
    color: #fff;
    background: transparent;
    padding: .75rem 2rem;
    border-radius: 8px;
    font-weight: 600;
    transition: background .15s;
  }
  .hero-cta-secondary:hover { background: rgba(255,255,255,.12); color: #fff; }
  .bookshelf-wrap {
    position: relative;
    display: inline-block;
  }
  .bookshelf {
    display: flex;
    align-items: flex-end;
    gap: 8px;
    height: 280px;
    padding: 0 10px 0 0;
  }
  .book-spine {
    border-radius: 6px 2px 2px 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
    box-shadow: 4px 4px 12px rgba(0,0,0,.35), inset -3px 0 6px rgba(0,0,0,.15);
    overflow: hidden;
    cursor: default;
    transition: transform .2s, box-shadow .2s;
  }
  .book-spine:hover {
    transform: translateY(-8px);
    box-shadow: 6px 8px 20px rgba(0,0,0,.45), inset -3px 0 6px rgba(0,0,0,.15);
  }
  .book-spine::after {
    content: '';
    position: absolute;
    top: 0; left: 0; bottom: 0;
    width: 6px;
    background: rgba(0,0,0,.18);
    border-radius: 6px 0 0 6px;
  }
  .book-spine-label {
    writing-mode: vertical-rl;
    text-orientation: mixed;
    transform: rotate(180deg);
    font-size: .65rem;
    font-weight: 700;
    color: rgba(255,255,255,.9);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-height: 90%;
    padding: 8px 0;
    text-shadow: 0 1px 3px rgba(0,0,0,.3);
  }
  .floating-badge {
    position: absolute;
    top: 8px;
    right: -10px;
    background: rgba(255,255,255,.18);
    border: 1px solid rgba(255,255,255,.35);
    border-radius: 14px;
    padding: 12px 16px;
    backdrop-filter: blur(12px);
    text-align: center;
    min-width: 88px;
    box-shadow: 0 4px 20px rgba(0,0,0,.25);
  }
  .shelf-board {
    height: 10px;
    background: linear-gradient(180deg, #8d6e63, #6d4c41);
    border-radius: 4px;
    box-shadow: 0 4px 8px rgba(0,0,0,.4);
    margin-top: 4px;
  }

  /* STATS STRIP */
  .stats-strip {
    background: #fff;
    border-bottom: 3px solid #e3e8f0;
    box-shadow: 0 2px 8px rgba(0,0,0,.06);
  }
  .stat-item { border-right: 1px solid #e8ecf3; }
  .stat-item:last-child { border-right: none; }
  .stat-number { font-size: 2.4rem; font-weight: 800; line-height: 1; }

  /* SECTION TITLES */
  .sec-title { font-size: 1.55rem; font-weight: 800; margin: 0; }
  .sec-bar { width: 46px; height: 4px; border-radius: 3px; margin-top: 6px; }

  /* BOOK CARDS */
  .book-cover-img { height: 185px; object-fit: cover; width: 100%; }
  .book-cover-ph {
    height: 185px;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    display: flex; align-items: center; justify-content: center;
  }

  /* TOP-RATED STRIP */
  .top-rated-bg { background: #f0f4ff; }
  .rated-card {
    background: linear-gradient(135deg, #fffde7, #fff9c4);
    border-left: 5px solid #ffc107 !important;
    transition: transform .2s, box-shadow .2s;
  }
  .rated-card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(0,0,0,.12); }
  .rated-thumb { width: 80px; height: 110px; object-fit: cover; border-radius: 6px; flex-shrink: 0; }
  .rated-thumb-ph {
    width: 80px; height: 110px;
    background: linear-gradient(135deg, #fff9c4, #ffe082);
    border-radius: 6px; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
  }
  .stars-gold { color: #f9a825; font-size: .95rem; letter-spacing: 1px; }

  /* FEATURES */
  .feat-icon {
    width: 64px; height: 64px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.7rem; margin: 0 auto 1rem;
  }

  /* CTA BANNER */
  .cta-banner {
    background: linear-gradient(135deg, #0d47a1 0%, #283593 100%);
    border-radius: 20px;
    padding: 3rem;
  }
</style>
{% endblock %}


{% block pre_content %}

<!-- ═══════════════════ HERO ═══════════════════ -->
<section class="hero-section">
  <div class="container">
    <div class="row align-items-center g-5">

      <!-- Left: text + CTAs -->
      <div class="col-lg-6" style="position:relative;z-index:2;">
        <div class="d-flex align-items-center gap-3 mb-4">
          <div class="hero-logo-box">
            <i class="bi bi-book-half" style="font-size:2.5rem;"></i>
          </div>
          <div>
            <div style="font-size:2rem;font-weight:800;letter-spacing:-1px;line-height:1;">E-Library</div>
            <div style="font-size:.88rem;opacity:.75;">Electronic Library Management System</div>
          </div>
        </div>

        <h2 style="font-size:1.9rem;font-weight:700;line-height:1.3;" class="mb-3">
          Your Digital Gateway<br>to <span style="color:#90caf9;">Knowledge</span>
        </h2>
        <p style="font-size:1rem;opacity:.85;max-width:460px;" class="mb-4">
          Browse thousands of books, borrow them online, rate what you&rsquo;ve read,
          and track your entire reading journey &mdash; all in one place.
        </p>

        <div class="d-flex flex-wrap gap-3">
          <a href="{% url 'book_list' %}" class="btn hero-cta-primary btn-lg">
            <i class="bi bi-journals me-2"></i>Browse Books
          </a>
          {% if not user.is_authenticated %}
          <a href="{% url 'register' %}" class="btn hero-cta-secondary btn-lg">
            <i class="bi bi-person-plus me-2"></i>Register Free
          </a>
          {% else %}
          <a href="{% url 'my_borrowings' %}" class="btn hero-cta-secondary btn-lg">
            <i class="bi bi-bookmark-check me-2"></i>My Borrowings
          </a>
          {% endif %}
        </div>
      </div>

      <!-- Right: decorative bookshelf -->
      <div class="col-lg-6 d-none d-lg-flex justify-content-center" style="position:relative;z-index:2;">
        <div class="bookshelf-wrap">
          <div class="bookshelf">
            <div class="book-spine" style="width:52px;height:250px;background:linear-gradient(180deg,#e53935,#b71c1c);">
              <span class="book-spine-label">Science Fiction</span>
            </div>
            <div class="book-spine" style="width:44px;height:190px;background:linear-gradient(180deg,#8e24aa,#6a1b9a);">
              <span class="book-spine-label">Philosophy</span>
            </div>
            <div class="book-spine" style="width:58px;height:265px;background:linear-gradient(180deg,#1e88e5,#0d47a1);">
              <span class="book-spine-label">World History</span>
            </div>
            <div class="book-spine" style="width:48px;height:215px;background:linear-gradient(180deg,#43a047,#1b5e20);">
              <span class="book-spine-label">Psychology</span>
            </div>
            <div class="book-spine" style="width:62px;height:245px;background:linear-gradient(180deg,#f4511e,#bf360c);">
              <span class="book-spine-label">Classic Literature</span>
            </div>
            <div class="book-spine" style="width:46px;height:180px;background:linear-gradient(180deg,#00acc1,#006064);">
              <span class="book-spine-label">Technology</span>
            </div>
            <div class="book-spine" style="width:54px;height:230px;background:linear-gradient(180deg,#f9a825,#e65100);">
              <span class="book-spine-label">Self-Improvement</span>
            </div>
          </div>
          <!-- Shelf board -->
          <div class="shelf-board"></div>
          <!-- Floating rating badge -->
          <div class="floating-badge">
            <i class="bi bi-star-fill text-warning" style="font-size:1.2rem;"></i>
            <div style="font-size:1.4rem;font-weight:800;line-height:1.2;">4.8</div>
            <div style="font-size:.72rem;opacity:.75;">Avg Rating</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- ═══════════════════ STATS STRIP ═══════════════════ -->
<div class="stats-strip">
  <div class="container">
    <div class="row text-center py-4">
      <div class="col-4 stat-item py-2">
        <div class="stat-number text-primary">{{ stats.total_books }}</div>
        <div class="text-muted mt-1" style="font-size:.85rem;">
          <i class="bi bi-journals me-1"></i>Books
        </div>
      </div>
      <div class="col-4 stat-item py-2">
        <div class="stat-number text-success">{{ stats.total_authors }}</div>
        <div class="text-muted mt-1" style="font-size:.85rem;">
          <i class="bi bi-person-lines-fill me-1"></i>Authors
        </div>
      </div>
      <div class="col-4 py-2">
        <div class="stat-number text-warning">{{ stats.total_students }}</div>
        <div class="text-muted mt-1" style="font-size:.85rem;">
          <i class="bi bi-people me-1"></i>Students
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════════════ RECENTLY ADDED ═══════════════════ -->
<div style="background:#f8f9fa;padding:3rem 0;">
  <div class="container">
    <div class="d-flex align-items-start justify-content-between mb-4">
      <div>
        <h2 class="sec-title"><i class="bi bi-clock-history me-2 text-primary"></i>Recently Added</h2>
        <div class="sec-bar bg-primary"></div>
      </div>
      <a href="{% url 'book_list' %}" class="btn btn-outline-primary btn-sm align-self-center">
        View All <i class="bi bi-arrow-right ms-1"></i>
      </a>
    </div>

    {% if recent_books %}
    <div class="row row-cols-2 row-cols-md-3 row-cols-lg-6 g-3">
      {% for book in recent_books %}
      <div class="col">
        <div class="card h-100 book-card border-0 shadow-sm">
          <a href="{% url 'book_detail' book.pk %}">
            {% if book.cover_image %}
            <img src="{{ book.cover_image.url }}" class="book-cover-img rounded-top" alt="{{ book.title }}">
            {% else %}
            <div class="book-cover-ph rounded-top">
              <i class="bi bi-book text-primary" style="font-size:2.8rem;opacity:.45;"></i>
            </div>
            {% endif %}
          </a>
          <div class="card-body p-2 pb-1">
            <div class="fw-bold text-dark" style="font-size:.8rem;line-height:1.3;">
              <a href="{% url 'book_detail' book.pk %}" class="text-decoration-none text-dark">
                {{ book.title|truncatechars:38 }}
              </a>
            </div>
            <div class="text-muted" style="font-size:.75rem;">{{ book.author|default:"Unknown" }}</div>
            {% if book.category %}
            <span class="badge bg-light text-secondary border mt-1" style="font-size:.68rem;">{{ book.category }}</span>
            {% endif %}
          </div>
          <div class="card-footer bg-transparent border-0 px-2 pb-2 pt-0">
            {% if book.is_available %}
            <span class="badge bg-success" style="font-size:.68rem;"><i class="bi bi-check2 me-1"></i>Available</span>
            {% else %}
            <span class="badge bg-danger" style="font-size:.68rem;">Unavailable</span>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center text-muted py-5 bg-white rounded-3 shadow-sm">
      <i class="bi bi-inbox" style="font-size:3rem;opacity:.4;"></i>
      <p class="mt-2 mb-0">No books yet.
        {% if user.is_staff %}<a href="{% url 'book_create' %}">Add the first one!</a>{% endif %}
      </p>
    </div>
    {% endif %}
  </div>
</div>

<!-- ═══════════════════ TOP RATED ═══════════════════ -->
<div class="top-rated-bg" style="padding:3rem 0;">
  <div class="container">
    <div class="d-flex align-items-start justify-content-between mb-4">
      <div>
        <h2 class="sec-title"><i class="bi bi-trophy me-2 text-warning"></i>Top Rated Books</h2>
        <div class="sec-bar" style="background:#ffc107;"></div>
      </div>
      <a href="{% url 'book_list' %}" class="btn btn-outline-warning btn-sm align-self-center">
        See All <i class="bi bi-arrow-right ms-1"></i>
      </a>
    </div>

    {% if top_rated %}
    <div class="row g-4">
      {% for book in top_rated %}
      <div class="col-md-4">
        <div class="card h-100 border-0 shadow-sm rated-card">
          <div class="card-body d-flex gap-3 p-3">
            {% if book.cover_image %}
            <img src="{{ book.cover_image.url }}" class="rated-thumb" alt="{{ book.title }}">
            {% else %}
            <div class="rated-thumb-ph">
              <i class="bi bi-book" style="font-size:2rem;color:#f9a825;opacity:.7;"></i>
            </div>
            {% endif %}
            <div class="flex-grow-1 min-w-0">
              <span class="badge bg-warning text-dark mb-2" style="font-size:.7rem;">
                <i class="bi bi-trophy-fill me-1"></i>Rank #{{ forloop.counter }}
              </span>
              <h6 class="fw-bold mb-1" style="line-height:1.3;font-size:.92rem;">
                <a href="{% url 'book_detail' book.pk %}" class="text-decoration-none text-dark">
                  {{ book.title|truncatechars:52 }}
                </a>
              </h6>
              <div class="text-muted mb-2" style="font-size:.78rem;">{{ book.author|default:"Unknown" }}</div>
              <div class="stars-gold mb-2">
                {% with r=book.avg_rating %}
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                {% if r >= 4 %}<i class="bi bi-star-fill"></i>{% else %}<i class="bi bi-star" style="color:#dee2e6;"></i>{% endif %}
                {% if r >= 4.5 %}<i class="bi bi-star-fill"></i>{% else %}<i class="bi bi-star" style="color:#dee2e6;"></i>{% endif %}
                <span class="ms-1 fw-bold text-dark" style="font-size:.85rem;">{{ r|floatformat:1 }}/5</span>
                {% endwith %}
              </div>
              <a href="{% url 'book_detail' book.pk %}" class="btn btn-warning btn-sm" style="font-size:.78rem;">
                <i class="bi bi-eye me-1"></i>View
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center text-muted py-5 bg-white rounded-3 shadow-sm">
      <i class="bi bi-star" style="font-size:3rem;color:#ffc107;opacity:.5;"></i>
      <p class="mt-2 mb-0">No rated books yet. Borrow a book and leave the first review!</p>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}


{% block content %}

<!-- FEATURES -->
<div class="row g-4 mb-5">
  <div class="col-12 text-center mb-2">
    <h2 style="font-weight:800;">Why Use E-Library?</h2>
    <div style="width:46px;height:4px;background:#0d6efd;border-radius:3px;margin:6px auto 0;"></div>
  </div>
  <div class="col-md-4 text-center">
    <div class="feat-icon bg-primary bg-opacity-10">
      <i class="bi bi-search text-primary"></i>
    </div>
    <h5 class="fw-bold">Smart Search</h5>
    <p class="text-muted">Find books by title, author, or ISBN instantly across the entire catalog.</p>
  </div>
  <div class="col-md-4 text-center">
    <div class="feat-icon bg-success bg-opacity-10">
      <i class="bi bi-arrow-left-right text-success"></i>
    </div>
    <h5 class="fw-bold">Easy Borrowing</h5>
    <p class="text-muted">Borrow with one click. Return anytime. Keep track of your full history.</p>
  </div>
  <div class="col-md-4 text-center">
    <div class="feat-icon bg-warning bg-opacity-10">
      <i class="bi bi-star-fill text-warning"></i>
    </div>
    <h5 class="fw-bold">Rate &amp; Review</h5>
    <p class="text-muted">Share your thoughts after reading. Help other students pick their next book.</p>
  </div>
</div>

<!-- CTA banner (visitors only) -->
{% if not user.is_authenticated %}
<div class="cta-banner text-white text-center mb-4 shadow">
  <h3 class="fw-bold mb-2">Ready to start reading?</h3>
  <p style="opacity:.8;" class="mb-4">Join students already using E-Library and unlock full access.</p>
  <div class="d-flex gap-3 justify-content-center flex-wrap">
    <a href="{% url 'register' %}" class="btn btn-light btn-lg fw-bold px-5">
      <i class="bi bi-person-plus me-2"></i>Register for Free
    </a>
    <a href="{% url 'book_list' %}" class="btn btn-outline-light btn-lg px-5">
      <i class="bi bi-journals me-2"></i>Browse Books
    </a>
  </div>
</div>
{% endif %}

{% endblock %}
